# 金币记录器 (Coin Recorder)

一个功能丰富的个人金币记录和排行榜应用，支持本地存储和云端同步。

## 🌟 主要功能

### 📊 金币记录
- **记录金币**：记录每日金币数量变化
- **历史记录**：查看、编辑、删除历史记录
- **批量录入**：支持批量添加记录
- **数据统计**：实时统计总金币、当前金币、连续记录天数

### 📈 数据可视化
- **图表分析**：金币增长趋势图、每日记录图
- **统计面板**：详细的数据统计和分析
- **图表缩放**：支持图表缩放和重置视图

### 🏆 成就系统
- **等级系统**：新手、白银、黄金、黑金、传奇等9个等级
- **成就徽章**：首次记录、连续记录、金币里程碑等
- **称号系统**：多维度称号展示

### 🌐 云端同步
- **数据备份**：自动同步到云端，防止数据丢失
- **多设备同步**：支持多设备间数据同步
- **离线使用**：支持离线使用，联网时自动同步

### 🏅 排行榜系统
- **扁平化设计**：采用紧凑的扁平长条表头，最大化数据展示区域
- **核心数据优先**：表头只显示图标、标题和核心统计，节省空间
- **手动刷新控制**：用户完全控制数据刷新时机，避免意外流量消耗
- **实时显示**：数据获取完成后立即显示排行榜内容，无需额外操作
- **跨设备适配**：完美支持桌面、平板、手机等各种设备形态

## 🚀 快速开始

### 环境要求
- 现代浏览器（Chrome、Firefox、Safari、Edge）
- 本地HTTP服务器（用于开发）

### 安装步骤

1. **克隆项目**
   ```bash
   git clone https://github.com/zkxxkz2/coin-recorder-cloud.git
   cd coin-recorder-cloud
   ```

2. **启动本地服务器**
   ```bash
   # 使用Node.js (推荐)
   node server.js

   # 或使用Python
   python -m http.server 8001

   # 或使用其他服务器工具
   npx serve . -p 8001
   ```

3. **访问应用**
   打开浏览器访问 `http://localhost:8001`

### 云端配置（可选）

如需使用云端同步功能，需要配置 JSONBin.io：

1. 注册 [JSONBin.io](https://jsonbin.io) 账号
2. 获取 API Key
3. 在 `jsonbin-config.js` 中配置：
   ```javascript
   window.jsonbinConfig = {
       apiKey: 'your-api-key-here'
   };
   ```

## 📱 使用指南

### 基本操作

1. **记录金币**
   - 点击"记录金币"按钮
   - 输入金币数量和备注
   - 点击"添加记录"

2. **查看统计**
   - 在"统计"标签页查看数据统计
   - 在"图表"标签页查看可视化图表

3. **云端同步**
   - 点击右上角头像
   - 选择"上传到云端"或"从云端下载"

4. **加入排行榜**
   - 点击"加入排行榜"按钮
   - 确认加入公开排行榜

### 高级功能

- **批量录入**：点击"批量录入"按钮，支持一次性添加多条记录
- **数据导出**：支持导出数据为JSON格式
- **主题切换**：支持亮色/暗色主题切换
- **移动端适配**：完全支持移动端使用

## 🎮 成就系统

### 等级系统
- 🌱 **新手**：0-1,000 金币
- 🥈 **白银**：1,000-5,000 金币
- 🥇 **黄金**：5,000-15,000 金币
- 🖤 **黑金**：15,000-30,000 金币
- ⭐ **传奇**：30,000-40,000 金币
- 🥉 **青铜传奇**：40,000-50,000 金币
- 🥈 **白银传奇**：50,000-70,000 金币
- 🥇 **黄金传奇**：70,000-100,000 金币
- 🖤 **黑金传奇**：100,000+ 金币

### 成就类型
- **首次记录**：完成第一次金币记录
- **连续记录**：连续记录天数成就
- **金币里程碑**：达到特定金币数量
- **挑战成就**：完成特定挑战任务

## 🔧 技术特性

### 前端技术
- **纯HTML/CSS/JavaScript**：无需框架，轻量级
- **ES6模块**：现代化的模块化开发
- **Service Worker**：支持离线使用
- **响应式设计**：适配各种屏幕尺寸

### 数据存储
- **本地存储**：使用LocalStorage存储数据
- **云端同步**：JSONBin.io云端存储
- **数据备份**：自动备份和恢复

### 性能优化
- **缓存机制**：智能缓存减少API调用
- **批量处理**：优化大量数据处理
- **懒加载**：按需加载数据

## 📁 项目结构

```
coin-recorder-cloud/
├── index.html              # 主页面
├── script.js               # 核心逻辑
├── styles.css              # 样式文件
├── sw.js                   # Service Worker
├── simple-auth.js          # 认证服务
├── simple-integration.js   # 集成服务
├── jsonbin-sync.js         # 云端同步
├── jsonbin-config.js       # 配置文件
├── server.js               # Node.js开发服务器
├── icons/                  # 应用图标
├── manifest.json           # PWA配置
└── README.md              # 项目说明和修复记录
```

## 📋 Version History

### v5.10.0 (最新版本)
- **排行榜项目统一**: 修复了排行榜项目布局，让奖牌/名字/称号在同一行显示
- **按钮并排设计**: 刷新和加入/退出按钮采用并排的细长设计
- **亮色模式增强**: 大幅提升亮色模式下按钮和文本的可见性和对比度
- **布局统一化**: 统一了宽屏和窄屏的排行榜显示方式，避免布局混乱
- **跨设备适配**: 优化了各种屏幕尺寸下的显示效果和用户体验
- **主题适配完善**: 确保所有UI元素在不同主题模式下都有良好的可读性

### v5.3.1
- **数据校验修复**: 修复了数据校验功能不可用的问题
- **同步服务初始化**: 改进了模块初始化时序和错误处理
- **错误处理增强**: 添加了更好的用户反馈和调试功能
- **稳定性改进**: 解决了各种同步和校验相关的问题

### v5.3.0
- **排行榜简化**: 移除了增长榜、活跃榜和成就榜，只保留主排行榜以获得更清爽的用户体验
- **服务器设置**: 添加了Node.js HTTP服务器用于本地开发，端口8001
- **代码优化**: 简化了JavaScript代码，移除了未使用的排行榜功能
- **性能提升**: 减少了包大小并提升了加载速度

### v5.2.0
- **功能增强**: 添加了包含多个排名类别的综合排行榜系统
- **UI改进**: 增强了用户界面，提供更好的导航和视觉反馈
- **错误修复**: 修复了数据同步和用户界面相关的各种问题

### v5.1.2
- **数据验证**: 添加了强大的数据验证以提升数据完整性
- **同步改进**: 修复了云端同步中的时序问题
- **稳定性增强**: 提升了整体应用稳定性

### v5.1.1
- **版本发布**: 带有小幅改进的版本发布
- **性能优化**: 优化了代码结构并减少了内存使用

### v3.1.0
- **UI修复**: 修复了登录按钮可见性和批量模态框关闭按钮功能
- **用户体验**: 改进了整体用户界面交互

### v3.0.9
- **模态框改进**: 增强了批量模态框关闭按钮功能
- **缓存修复**: 解决了登录按钮缓存问题
- **稳定性**: 提升了应用可靠性

## 🔧 故障排除和修复记录

### 已知问题修复

#### 云端同步数据丢失问题 (v5.3.1)
**问题描述**：用户在使用云端同步功能时，隔几天登录账号并上传数据后，本地的这几天数据会消失，无法从云端正常下载数据。

**根本原因**：原始的同步策略采用"云端完全覆盖本地"的合并方式，导致本地数据被完全替换。

**修复方案**：
- **智能数据合并**：实现基于时间戳的双向智能合并策略
- **本地优先保护**：上传时使用本地优先策略保护用户新数据
- **时间戳管理**：改进时间戳处理和冲突解决机制
- **详细日志**：添加同步过程的详细日志便于调试

**技术细节**：
- 实现了 `mergeData()` 和 `mergeDataWithLocalPriority()` 两个合并函数
- 基于时间戳判断数据新旧，避免数据丢失
- 添加了 `mergeCoinRecords()` 函数处理记录级冲突
- 增强了错误处理和用户反馈机制

#### 数据校验功能不可用 (v5.3.1)
**问题描述**：数据校验功能报错"云端同步服务不可用"，无法正常使用。

**根本原因**：模块初始化时序问题，`syncService` 在 `simpleIntegration` 完全初始化之前就被使用。

**修复方案**：
- **延迟初始化**：使用 `setTimeout` 延迟同步服务初始化
- **智能等待**：添加初始化状态检查和等待机制
- **错误处理**：增强错误提示和调试日志
- **用户反馈**：提供友好的等待和错误提示

**技术细节**：
- 修改了 `JSONBinSyncService` 构造函数的初始化时序
- 增强了 `getCloudDataForValidation()` 函数的检查逻辑
- 改进了 `enableCloudSync()` 函数的初始化等待机制
- 添加了详细的控制台调试日志

#### 排行榜UI适配移动端 (v5.5.0)
**问题描述**：排行榜界面在手机浏览器上内容太多、太拥挤，用户体验不佳。

**修复方案**：
- **完全重构UI**：重新设计排行榜界面，适配移动设备
- **手动刷新模式**：从自动刷新改为用户主动控制
- **紧凑布局**：大幅减少内边距、字体大小和元素间距
- **响应式设计**：针对768px、480px等关键断点进行优化

**技术细节**：
- HTML结构简化：从多标签页设计改为单一主排行榜
- CSS样式压缩：字体从2.5rem减少到1.1rem（手机端）
- 元素尺寸优化：用户头像从50px减少到24px（手机端）
- 移动端断点：针对不同屏幕尺寸提供专门的样式规则

#### 排行榜用户体验优化 (v5.5.0)
**问题描述**：排行榜交互逻辑不够完善，用户操作后反馈不完整。

**修复方案**：
- **完整用户流程**：优化了重复加入排行榜的处理逻辑
- **无缝体验**：检测到用户已存在时，直接显示排行榜内容
- **状态同步**：确保本地状态和UI状态的一致性

### 使用建议

#### 云端同步
1. **先备份**：在进行重要同步前，建议先备份数据
2. **逐步同步**：避免同时在多个设备上进行大量数据修改
3. **检查日志**：如果遇到问题，查看浏览器控制台的同步日志
4. **定期验证**：定期验证本地和云端数据的一致性

#### 排行榜使用
1. **手动刷新**：排行榜数据需要用户主动点击刷新按钮获取
2. **重复操作**：如果已在排行榜中，再次点击"加入"会直接显示排行榜内容
3. **移动端友好**：界面已优化适配手机浏览器使用

#### 故障排除
1. **等待初始化**：登录后请等待几秒让同步服务完全初始化
2. **网络连接**：确保网络连接稳定
3. **重新登录**：如果遇到问题，可以尝试重新登录
4. **查看日志**：遇到问题时查看浏览器控制台的调试日志
5. **清除缓存**：如果功能异常，尝试清除浏览器缓存

### 验证方法

#### 功能测试
1. **同步测试**：
   - 在本地添加记录 → 上传到云端 → 清除本地数据 → 从云端下载
   - 验证数据完整性和合并结果

2. **校验测试**：
   - 登录账号 → 等待初始化 → 点击数据校验
   - 验证不再出现"云端同步服务不可用"错误

3. **排行榜测试**：
   - 登录已在排行榜中的账号 → 点击"加入排行榜"
   - 验证显示提示后自动显示排行榜内容

4. **响应式测试**：
   - 在不同屏幕尺寸下测试排行榜显示效果
   - 验证移动端的触摸友好性和可读性

## 🔒 隐私保护

- **本地优先**：数据优先存储在本地
- **可选同步**：云端同步完全可选
- **数据加密**：敏感数据加密存储
- **匿名化**：排行榜只显示用户名，不显示个人信息

## 🐛 问题反馈

如果您遇到问题或有建议，请：

1. 检查浏览器控制台是否有错误信息
2. 确认网络连接正常
3. 尝试清除浏览器缓存
4. 在GitHub Issues中提交问题

## 📄 许可证

本项目采用 MIT 许可证。详情请参阅 [LICENSE](LICENSE) 文件。

## 🙏 致谢

感谢所有贡献者和用户的支持！

---

**版本**: v5.10.0
**最后更新**: 2025年10月

> 💡 **提示**: 建议定期备份数据，避免意外丢失。使用云端同步功能可以更好地保护您的数据。
