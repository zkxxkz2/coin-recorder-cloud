<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONBin.io æ•°æ®è¯»å–æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .test-section h3 {
            margin-top: 0;
            color: #555;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .bin-id-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px 0;
            font-family: monospace;
        }
        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .loading {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” JSONBin.io æ•°æ®è¯»å–æµ‹è¯•</h1>
        
        <div class="status" id="status">å‡†å¤‡å°±ç»ª</div>
        
        <div class="test-section">
            <h3>ğŸ“– è¯»å–ç°æœ‰ Bin</h3>
            <p>è¾“å…¥ Bin ID æ¥æµ‹è¯•è¯»å–æ•°æ®ï¼š</p>
            <input type="text" id="binIdInput" class="bin-id-input" placeholder="è¾“å…¥ Bin IDï¼Œä¾‹å¦‚: 68eb169543b1c97be9637192">
            <button onclick="testReadBin()">è¯»å–æ•°æ®</button>
            <button onclick="testKnownBins()">æµ‹è¯•å·²çŸ¥ Bin IDs</button>
            <div id="readResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª åˆ›å»ºæµ‹è¯• Bin</h3>
            <p>åˆ›å»ºä¸€ä¸ªæ–°çš„æµ‹è¯• bin æ¥éªŒè¯ API åŠŸèƒ½ï¼š</p>
            <button onclick="testCreateBin()">åˆ›å»ºæµ‹è¯• Bin</button>
            <div id="createResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š æ•°æ®ç»Ÿè®¡</h3>
            <button onclick="showDataStats()">æ˜¾ç¤ºæ•°æ®ç»Ÿè®¡</button>
            <div id="statsResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script type="module">
        // å¯¼å…¥é…ç½®
        import { jsonbinConfig } from './jsonbin-config.js';
        
        let currentBinId = null;
        
        // æ›´æ–°çŠ¶æ€
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, content, type = 'info') {
            const resultEl = document.getElementById(elementId);
            resultEl.textContent = content;
            resultEl.className = `result ${type}`;
            resultEl.style.display = 'block';
        }
        
        // æµ‹è¯•è¯»å–æŒ‡å®š Bin
        window.testReadBin = async function() {
            const binId = document.getElementById('binIdInput').value.trim();
            if (!binId) {
                showResult('readResult', 'è¯·è¾“å…¥ Bin ID', 'error');
                return;
            }
            
            updateStatus('æ­£åœ¨è¯»å–æ•°æ®...', 'loading');
            
            try {
                const response = await fetch(`${jsonbinConfig.baseUrl}/b/${binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': jsonbinConfig.apiKey
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    currentBinId = binId;
                    
                    const summary = `
âœ… è¯»å–æˆåŠŸ!

ğŸ“Š æ•°æ®æ¦‚è§ˆ:
- Bin ID: ${binId}
- é‡‘å¸è®°å½•æ•°: ${result.record.coinRecords?.length || 0}
- ç”¨æˆ·æ•°: ${result.record.users?.length || 0}
- æˆå°±æ•°: ${result.record.achievements ? Object.keys(result.record.achievements).length : 0}
- æœ€ååŒæ­¥: ${result.record.lastSync || 'æœªçŸ¥'}

ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯:
${result.record.users?.map((user, i) => `   ${i + 1}. ç”¨æˆ·å: ${user.username}, ID: ${user.id}`).join('\n') || '   æ— ç”¨æˆ·æ•°æ®'}

ğŸ’° æœ€è¿‘çš„é‡‘å¸è®°å½•:
${result.record.coinRecords?.slice(-3).map((record, i) => `   ${i + 1}. ${record.date}: ${record.coins} é‡‘å¸`).join('\n') || '   æ— é‡‘å¸è®°å½•'}

ğŸ“„ å®Œæ•´æ•°æ®:
${JSON.stringify(result.record, null, 2)}
                    `;
                    
                    showResult('readResult', summary, 'success');
                    updateStatus('æ•°æ®è¯»å–æˆåŠŸ!', 'success');
                } else {
                    const errorText = await response.text();
                    showResult('readResult', `âŒ è¯»å–å¤±è´¥: ${response.status} ${response.statusText}\né”™è¯¯ä¿¡æ¯: ${errorText}`, 'error');
                    updateStatus('æ•°æ®è¯»å–å¤±è´¥', 'error');
                }
            } catch (error) {
                showResult('readResult', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
                updateStatus('ç½‘ç»œé”™è¯¯', 'error');
            }
        };
        
        // æµ‹è¯•å·²çŸ¥çš„ Bin IDs
        window.testKnownBins = async function() {
            const knownBinIds = [
                '68eb169543b1c97be9637192',
                '68eb146843b1c97be9637070',
                '68eb142fae596e708f0f2744'
            ];
            
            updateStatus('æ­£åœ¨æµ‹è¯•å·²çŸ¥ Bin IDs...', 'loading');
            
            let results = 'ğŸ” æµ‹è¯•å·²çŸ¥ Bin IDs:\n\n';
            let successCount = 0;
            
            for (const binId of knownBinIds) {
                try {
                    const response = await fetch(`${jsonbinConfig.baseUrl}/b/${binId}/latest`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': jsonbinConfig.apiKey
                        }
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        results += `âœ… ${binId}: æˆåŠŸ\n`;
                        results += `   - ç”¨æˆ·: ${result.record.users?.length || 0} ä¸ª\n`;
                        results += `   - è®°å½•: ${result.record.coinRecords?.length || 0} æ¡\n`;
                        results += `   - åŒæ­¥: ${result.record.lastSync || 'æœªçŸ¥'}\n\n`;
                        successCount++;
                    } else {
                        results += `âŒ ${binId}: ${response.status} ${response.statusText}\n\n`;
                    }
                } catch (error) {
                    results += `âŒ ${binId}: ${error.message}\n\n`;
                }
            }
            
            results += `ğŸ“Š æµ‹è¯•ç»“æœ: ${successCount}/${knownBinIds.length} ä¸ª Bin å¯è®¿é—®`;
            
            showResult('readResult', results, successCount > 0 ? 'success' : 'error');
            updateStatus(`æµ‹è¯•å®Œæˆ: ${successCount}/${knownBinIds.length} æˆåŠŸ`, successCount > 0 ? 'success' : 'error');
        };
        
        // æµ‹è¯•åˆ›å»º Bin
        window.testCreateBin = async function() {
            updateStatus('æ­£åœ¨åˆ›å»ºæµ‹è¯• Bin...', 'loading');
            
            const testData = {
                test: true,
                message: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ•°æ®',
                timestamp: new Date().toISOString(),
                coinRecords: [],
                streakData: {
                    currentStreak: 0,
                    longestStreak: 0,
                    lastRecordDate: null,
                    todayCompleted: false
                },
                achievements: null,
                challengeData: {
                    target: 0,
                    startDate: null,
                    endDate: null,
                    currentProgress: 0,
                    completed: false,
                    completedDate: null
                },
                lastSync: new Date().toISOString(),
                users: []
            };
            
            try {
                const response = await fetch(`${jsonbinConfig.baseUrl}/b`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': jsonbinConfig.apiKey
                    },
                    body: JSON.stringify(testData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    currentBinId = result.metadata.id;
                    
                    const summary = `
âœ… æµ‹è¯• Bin åˆ›å»ºæˆåŠŸ!

ğŸ“Š Bin ä¿¡æ¯:
- Bin ID: ${result.metadata.id}
- åˆ›å»ºæ—¶é—´: ${result.metadata.createdAt}
- ç§æœ‰: ${result.metadata.private}

ğŸ“„ åˆ›å»ºçš„æ•°æ®:
${JSON.stringify(result.record, null, 2)}
                    `;
                    
                    showResult('createResult', summary, 'success');
                    updateStatus('æµ‹è¯• Bin åˆ›å»ºæˆåŠŸ!', 'success');
                    
                    // è‡ªåŠ¨å¡«å……åˆ°è¾“å…¥æ¡†
                    document.getElementById('binIdInput').value = result.metadata.id;
                } else {
                    const errorText = await response.text();
                    showResult('createResult', `âŒ åˆ›å»ºå¤±è´¥: ${response.status} ${response.statusText}\né”™è¯¯ä¿¡æ¯: ${errorText}`, 'error');
                    updateStatus('æµ‹è¯• Bin åˆ›å»ºå¤±è´¥', 'error');
                }
            } catch (error) {
                showResult('createResult', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
                updateStatus('ç½‘ç»œé”™è¯¯', 'error');
            }
        };
        
        // æ˜¾ç¤ºæ•°æ®ç»Ÿè®¡
        window.showDataStats = function() {
            if (!currentBinId) {
                showResult('statsResult', 'è¯·å…ˆè¯»å–ä¸€ä¸ª Bin çš„æ•°æ®', 'error');
                return;
            }
            
            updateStatus('æ­£åœ¨åˆ†ææ•°æ®...', 'loading');
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´è¯¦ç»†çš„æ•°æ®åˆ†æ
            const stats = `
ğŸ“Š æ•°æ®ç»Ÿè®¡åˆ†æ

å½“å‰ Bin ID: ${currentBinId}

ğŸ’¡ æç¤º: è¿™æ˜¯ä¸€ä¸ªåŸºç¡€çš„æ•°æ®è¯»å–æµ‹è¯•å·¥å…·ã€‚
è¦è·å¾—è¯¦ç»†çš„æ•°æ®ç»Ÿè®¡ï¼Œè¯·å…ˆä½¿ç”¨"è¯»å–æ•°æ®"åŠŸèƒ½è·å–å®Œæ•´æ•°æ®ã€‚

ğŸ”§ åŠŸèƒ½è¯´æ˜:
- è¯»å–ç°æœ‰ Bin æ•°æ®
- åˆ›å»ºæµ‹è¯• Bin
- éªŒè¯ API è¿æ¥
- æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
            `;
            
            showResult('statsResult', stats, 'info');
            updateStatus('æ•°æ®ç»Ÿè®¡å®Œæˆ', 'info');
        };
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('JSONBin.io æ•°æ®è¯»å–æµ‹è¯•å·¥å…·å·²å°±ç»ª', 'success');
        });
    </script>
</body>
</html>
