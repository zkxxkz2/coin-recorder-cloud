<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>金币记录器</title>

    <!-- PWA支持 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="金币记录器">

    <!-- 移动端优化 -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#6366f1">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="format-detection" content="telephone=no">

    <!-- 防止缩放和优化触摸 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <!-- iOS Safari优化 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">

    <!-- 桌面快捷方式图标 -->
    <link rel="shortcut icon" href="icons/icon-192.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <!-- 预加载资源 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    
    <!-- JSONBin.io 配置 -->
    <script type="module">
        // JSONBin.io 配置 - 请替换为您的实际 API 密钥
        window.jsonbinConfig = {
            apiKey: "$2a$10$lzTGizSjITzjqFfFLVRKK.D6sTi07OqOE7Nea1t5pWQNFQEfe/k9C"
        };
    </script>
</head>
<body>
    <!-- 顶部状态栏 -->
    <header class="app-header">
        <div class="header-left">
            <h1 class="app-title">
                <span>金币记录器</span>
                <span class="version-badge">v5.7.0</span>
            </h1>
                </div>
        <div class="header-right">
            <button id="themeToggle" class="header-icon-btn theme-toggle-btn" title="切换主题">
                <span class="theme-icon">🌙</span>
                            </button>
                        </div>
    </header>

    <!-- 主要内容区域 -->
    <main class="app-main">
        <div class="app-container">
            <!-- Tab内容区 -->
            <div class="tab-content active" data-tab-content="home">
                <!-- 今日统计卡片 -->
                <div class="stats-card">
                    <div class="skeleton" id="statsSkeleton" style="display: none;">
                        <div class="skeleton-grid">
                            <div class="skeleton-stat"></div>
                            <div class="skeleton-stat"></div>
                            <div class="skeleton-stat"></div>
                            <div class="skeleton-stat"></div>
                        </div>
                    </div>
                    <div class="section-content" id="statsContent">
                        <h3 class="card-title">📊 今日统计</h3>
                        <div class="stats-grid">
                            <div class="stat-box">
                                <span class="stat-label">今日金币</span>
                                <span class="stat-value" id="todayCoins">-</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">记录次数</span>
                                <span class="stat-value" id="recordDays">-</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">与昨日差值</span>
                                <span class="stat-value" id="difference">-</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">总金币</span>
                                <span class="stat-value" id="totalCoins">-</span>
                        </div>
                    </div>
                </div>
            </div>

                <!-- 快速操作卡片 -->
                <div class="action-card">
            <div class="skeleton" id="inputSkeleton" style="display: none;">
                <div class="skeleton-input"></div>
                <div class="skeleton-button"></div>
            </div>
            <div class="section-content" id="inputContent">
                        <h3 class="card-title">
                            <span>💰 快速记录</span>
                        <div class="current-time" id="currentTime">--:--</div>
                        </h3>
                        <form id="coinForm" class="quick-form">
                    <div class="form-group">
                                <input type="number" id="coinAmount" name="coinAmount" min="0" placeholder="输入今日金币数量" required>
                    </div>
                    <div class="form-group">
                                <input type="text" id="note" name="note" maxlength="50" placeholder="备注（可选）">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">添加记录</button>
                                <button type="button" id="makeupRecordBtn" class="btn-secondary" style="display: none;">补签</button>
                    </div>
                </form>
            </div>
                </div>

                <!-- 连击统计卡片 -->
                <div class="streak-card">
                    <div class="skeleton" id="streakSkeleton" style="display: none;">
                        <div class="skeleton-streak"></div>
                    </div>
                    <div class="section-content" id="streakContent">
                        <h3 class="card-title">🔥 连击统计</h3>
                        <div class="streak-display">
                            <div class="streak-main">
                                <span class="streak-number" id="currentStreak">0</span>
                                <span class="streak-unit">天连击</span>
                            </div>
                            <div class="streak-info">
                                <div class="streak-item">
                                    <span>最长连击</span>
                                    <span id="longestStreak">0天</span>
                                </div>
                                <div class="streak-item">
                                    <span>今日状态</span>
                                    <span id="todayComplete">未完成</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 挑战进度卡片 -->
                <div class="challenge-card">
                    <div class="skeleton" id="challengeSkeleton" style="display: none;">
                        <div class="skeleton-progress"></div>
                    </div>
                    <div class="section-content" id="challengeContent">
                        <h3 class="card-title">
                            <span>🎯 挑战进度</span>
                            <div class="challenge-actions">
                                <button id="refreshChallengeBtn" class="btn-icon" title="刷新">🔄</button>
                                <button id="setChallengeBtn" class="btn-icon" title="设置目标">⚙️</button>
                                <button id="batchInputBtn" class="btn-icon" title="批量录入">📊</button>
                            </div>
                        </h3>
                        <div id="currentChallengeInfo" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="challengeProgressFill" style="width: 0%"></div>
                            </div>
                            <div class="progress-stats">
                                <div class="progress-stat">
                                    <span>目标</span>
                                    <span id="challengeTarget">0</span>
                                </div>
                                <div class="progress-stat">
                                    <span>当前</span>
                                    <span id="challengeProgress">0</span>
                                </div>
                                <div class="progress-stat">
                                    <span>完成度</span>
                                    <span id="challengePercentage">0%</span>
                                </div>
                            </div>
                        </div>
                        <div id="noChallengeInfo" class="no-challenge">
                            <p>还没有设定挑战，点击右上角设置目标吧！</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 图表Tab -->
            <div class="tab-content" data-tab-content="charts">
                <div class="chart-card">
                    <div class="skeleton" id="chartSkeleton" style="display: none;">
                        <div class="skeleton-chart"></div>
                    </div>
                    <div class="section-content" id="chartContent">
                        <h3 class="card-title">📈 数据可视化</h3>
                        <div class="chart-controls">
                            <div class="chart-tabs">
                                <button class="tab-btn active" data-tab="totalChart">总金币</button>
                                <button class="tab-btn" data-tab="dailyChart">每日</button>
                                <button class="tab-btn" data-tab="weeklyChart">周统计</button>
                                <button class="tab-btn" data-tab="monthlyChart">月统计</button>
                            </div>
                            <button id="resetZoomBtn" class="btn-icon">🔄</button>
                        </div>
                        <div class="chart-container">
                            <canvas id="totalChart"></canvas>
                            <canvas id="dailyChart" style="display: none;"></canvas>
                            <canvas id="weeklyChart" style="display: none;"></canvas>
                            <canvas id="monthlyChart" style="display: none;"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 成就Tab -->
            <div class="tab-content" data-tab-content="achievements">
                <div class="achievements-card">
                    <div class="skeleton" id="achievementsSkeleton" style="display: none;">
                        <div class="skeleton-achievements"></div>
                    </div>
                    <div class="section-content" id="achievementsContent">
                        <h3 class="card-title">🏆 成就系统</h3>
                        <div class="achievements-grid">
                            <div class="achievement-item" data-achievement="first_record">
                                <div class="achievement-icon">🎯</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">首次记录</div>
                                    <div class="achievement-desc">完成第一次金币记录，即可解锁。</div>
                                </div>
                                <div class="achievement-status" id="first_record_status">🔒</div>
                            </div>
                            <div class="achievement-item" data-achievement="week_streak">
                                <div class="achievement-icon">🔥</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">坚持7天</div>
                                    <div class="achievement-desc">连续记录7天金币，保持良好习惯。</div>
                                </div>
                                <div class="achievement-status" id="week_streak_status">🔒</div>
                            </div>
                            <div class="achievement-item" data-achievement="month_streak">
                                <div class="achievement-icon">📅</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">坚持30天</div>
                                    <div class="achievement-desc">连续记录30天金币，完成月度挑战。</div>
                                </div>
                                <div class="achievement-status" id="month_streak_status">🔒</div>
                            </div>
                            <div class="achievement-item" data-achievement="hundred_days">
                                <div class="achievement-icon">💯</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">百日坚持</div>
                                    <div class="achievement-desc">连续记录100天金币，达成百日里程碑。</div>
                                </div>
                                <div class="achievement-status" id="hundred_days_status">🔒</div>
                            </div>
                            <div class="achievement-item" data-achievement="novice_level">
                                <div class="achievement-icon">🌱</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">新手</div>
                                    <div class="achievement-desc">累计金币 ≥ 0，即可解锁新手等级。</div>
                                </div>
                                <div class="achievement-status" id="novice_level_status">🔒</div>
                            </div>
                            <div class="achievement-item" data-achievement="silver_level">
                                <div class="achievement-icon">🥈</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">白银</div>
                                    <div class="achievement-desc">累计金币 ≥ 1,000，晋升白银等级。</div>
                                </div>
                                <div class="achievement-status" id="silver_level_status">🔒</div>
                            </div>
                            <div class="achievement-item" data-achievement="gold_level">
                                <div class="achievement-icon">🥇</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">黄金</div>
                                    <div class="achievement-desc">累计金币 ≥ 5,000，晋升黄金等级。</div>
                                </div>
                                <div class="achievement-status" id="gold_level_status">🔒</div>
                            </div>
                            <div class="achievement-item" data-achievement="black_gold_level">
                                <div class="achievement-icon">⚫</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">黑金</div>
                                    <div class="achievement-desc">累计金币 ≥ 15,000，晋升黑金等级。</div>
                                </div>
                                <div class="achievement-status" id="black_gold_level_status">🔒</div>
                            </div>
                            <div class="achievement-item" data-achievement="legend_level">
                                <div class="achievement-icon">👑</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">传奇</div>
                                    <div class="achievement-desc">累计金币 ≥ 30,000，晋升传奇等级。</div>
                                </div>
                                <div class="achievement-status" id="legend_level_status">🔒</div>
                            </div>
                            <div class="achievement-item" data-achievement="bronze_legend_level">
                                <div class="achievement-icon">🏆</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">青铜传奇</div>
                                    <div class="achievement-desc">累计金币 ≥ 40,000，晋升青铜传奇。</div>
                                </div>
                                <div class="achievement-status" id="bronze_legend_level_status">🔒</div>
                            </div>
                            <div class="achievement-item" data-achievement="silver_legend_level">
                                <div class="achievement-icon">💎</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">白银传奇</div>
                                    <div class="achievement-desc">累计金币 ≥ 50,000，晋升白银传奇。</div>
                                </div>
                                <div class="achievement-status" id="silver_legend_level_status">🔒</div>
                            </div>
                            <div class="achievement-item" data-achievement="gold_legend_level">
                                <div class="achievement-icon">⭐</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">黄金传奇</div>
                                    <div class="achievement-desc">累计金币 ≥ 70,000，晋升黄金传奇。</div>
                                </div>
                                <div class="achievement-status" id="gold_legend_level_status">🔒</div>
                            </div>
                            <div class="achievement-item" data-achievement="black_gold_legend_level">
                                <div class="achievement-icon">🌟</div>
                                <div class="achievement-info">
                                    <div class="achievement-title">黑金传奇</div>
                                    <div class="achievement-desc">累计金币 ≥ 100,000，晋升黑金传奇。</div>
                                </div>
                                <div class="achievement-status" id="black_gold_legend_level_status">🔒</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 排行榜Tab -->
            <div class="tab-content" data-tab-content="leaderboard">
                <div class="leaderboard-container">
                    <!-- 紧凑的排行榜表头 -->
                    <div class="leaderboard-header-bar">
                        <div class="header-bar-left">
                            <div class="header-icon">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <h1 class="header-title">金币排行榜</h1>
                        </div>

                        <div class="header-stats">
                            <div class="mini-stat">
                                <span class="mini-number" id="bannerParticipantCount">0</span>
                                <span class="mini-label">参与者</span>
                            </div>
                            <div class="mini-stat">
                                <span class="mini-number" id="bannerTotalCoins">0</span>
                                <span class="mini-label">总金币</span>
                            </div>
                        </div>

                        <button id="refreshBannerBtn" class="mini-refresh-btn">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 4V9H4.58152M20 20V15H19.4185M4.58152 9C5.80611 7.7667 7.4179 7 9.17623 7C12.7136 7 15.5 9.7864 15.5 13.3238C15.5 16.8611 12.7136 19.6476 9.17623 19.6476C7.4179 19.6476 5.80611 19.2333 4.58152 18M19.4185 15C18.1939 16.2333 16.5821 16.6476 14.8238 16.6476C11.2864 16.6476 8.5 13.8611 8.5 10.3238C8.5 6.7864 11.2864 4 14.8238 4C16.5821 4 18.1939 4.2333 19.4185 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>

                    <!-- 排行榜内容区域 -->
                    <div class="leaderboard-content-area">
                        <div class="leaderboard-list-container" id="leaderboardList">
                            <!-- 排行榜内容将被JavaScript动态填充 -->
                        </div>
                    </div>

                    <!-- 底部操作区域 -->
                    <div class="leaderboard-actions">
                        <button id="joinPublicLeaderboardBtn" class="action-btn primary">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16 21V19C16 17.9391 15.5786 16.9217 14.8284 16.1716C14.0783 15.4214 13.0609 15 12 15C10.9391 15 9.92172 15.4214 9.17157 16.1716C8.42143 16.9217 8 17.9391 8 19V21M20 9C20 13.4183 16.4183 17 12 17C7.58172 17 4 13.4183 4 9C4 4.58172 7.58172 1 12 1C16.4183 1 20 4.58172 20 9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>加入排行榜</span>
                        </button>
                        <button id="leaveLeaderboardBtn" class="action-btn danger" style="display: none;">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 21H5C3.89543 21 3 20.1046 3 19V5C3 3.89543 3.89543 3 5 3H19C20.1046 3 21 3.89543 21 5V9M16 17L21 12M21 12L16 7M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>退出排行榜</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 设置Tab -->
            <div class="tab-content" data-tab-content="settings">
                <!-- 账户管理卡片 -->
                <div class="account-card">
                    <h3 class="card-title">👤 账户管理</h3>
                    
                    <!-- 未登录状态 -->
                    <div id="loginSection" class="account-section">
                        <div class="account-info">
                            <p class="account-desc">登录后可同步数据到云端，防止数据丢失</p>
                    </div>
                        <button id="loginBtn" class="btn-primary btn-block">
                            <span>🔐</span>
                            <span>登录/注册</span>
                        </button>
                    </div>
                    
                    <!-- 已登录状态 -->
                    <div id="userStatus" class="account-section" style="display: none;">
                        <div class="user-info-card">
                            <div class="user-avatar">👤</div>
                            <div class="user-details">
                                <div class="user-name-display">
                                    <span id="userEmail" class="user-email-text"></span>
                    </div>
                                <div class="user-actions-grid">
                                    <button id="syncFromCloudBtn" class="action-card-btn">
                                        <span class="action-icon">⬇️</span>
                                        <span class="action-label">下载数据</span>
                                    </button>
                                    <button id="syncToCloudBtn" class="action-card-btn">
                                        <span class="action-icon">⬆️</span>
                                        <span class="action-label">上传数据</span>
                                    </button>
                                    <button id="showBinIdBtn" class="action-card-btn">
                                        <span class="action-icon">🔑</span>
                                        <span class="action-label">账户ID</span>
                                    </button>
                                    <button id="logoutBtn" class="action-card-btn logout">
                                        <span class="action-icon">🚪</span>
                                        <span class="action-label">退出登录</span>
                                    </button>
                    </div>
                </div>
            </div>
                </div>
            </div>

                <!-- 数据校验卡片 -->
                <div class="validation-card">
                    <h3 class="card-title">🔍 数据校验</h3>
                    <div class="validation-content">
                        <div class="validation-description">
                            <p>检查云端和本地数据是否一致，确保数据同步的准确性</p>
                        </div>
                        <div class="validation-actions">
                            <button id="validateDataBtn" class="btn-primary btn-block">
                                <span class="btn-icon">🔍</span>
                                <span>开始校验</span>
                            </button>
                        </div>
                        <div id="validationResult" class="validation-result" style="display: none;">
                            <div class="validation-status">
                                <div class="status-icon" id="validationStatusIcon">⏳</div>
                                <div class="status-text" id="validationStatusText">校验中...</div>
                            </div>
                            <div class="validation-details" id="validationDetails"></div>
                        </div>
                    </div>
                </div>

                <!-- 历史记录卡片 -->
                <div class="settings-card">
                    <div class="skeleton" id="historySkeleton" style="display: none;">
                        <div class="skeleton-list"></div>
                </div>
                    <div class="section-content" id="historyContent">
                        <h3 class="card-title">📜 历史记录</h3>
                        <div class="history-controls">
                            <button id="exportBtn" class="btn-secondary">导出数据</button>
                            <button id="clearBtn" class="btn-danger">清空记录</button>
            </div>
                        <div class="history-list" id="historyList"></div>
                        </div>
                    </div>
                </div>
            </div>
    </main>

    <!-- 底部Tab导航 -->
    <nav class="app-nav">
        <button class="nav-item active" data-tab="home">
            <span class="nav-icon">🏠</span>
            <span class="nav-label">首页</span>
        </button>
        <button class="nav-item" data-tab="charts">
            <span class="nav-icon">📊</span>
            <span class="nav-label">图表</span>
        </button>
        <button class="nav-item" data-tab="achievements">
            <span class="nav-icon">🏆</span>
            <span class="nav-label">成就</span>
        </button>
        <button class="nav-item" data-tab="leaderboard">
            <span class="nav-icon">📈</span>
            <span class="nav-label">排行</span>
        </button>
        <button class="nav-item" data-tab="settings">
            <span class="nav-icon">⚙️</span>
            <span class="nav-label">设置</span>
                    </button>
    </nav>

    <!-- 模态框 -->
    <!-- 批量录入模态框 -->
    <div id="batchInputModal" class="modal" style="display: none;">
        <div class="modal-backdrop">
            <div class="modal-content">
                <button class="modal-close batch-input-close">&times;</button>
                <h3 class="modal-title">📊 批量录入</h3>
                <div class="batch-input-form">
                    <div class="form-group">
                        <label for="startDate">开始日期</label>
                        <input type="date" id="startDate" required>
                    </div>
                    <div class="form-group">
                        <label for="endDate">结束日期</label>
                        <input type="date" id="endDate" required>
                    </div>
                    <div class="form-group">
                        <label for="batchCoins">每日金币数量</label>
                        <input type="number" id="batchCoins" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="batchNote">备注（可选）</label>
                        <input type="text" id="batchNote" maxlength="50">
                    </div>
                    <div class="batch-input-actions">
                        <button id="cancelBatchBtn" class="btn-secondary">取消</button>
                        <button id="confirmBatchBtn" class="btn-primary">确认</button>
                    </div>
                </div>
                <div id="batchPreview" class="batch-preview" style="display: none;">
                    <h4>预览</h4>
                    <div id="batchPreviewList" class="batch-preview-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 挑战设置模态框 -->
    <div id="challengeModal" class="modal" style="display: none;">
        <div class="modal-backdrop">
            <div class="modal-content">
                <button class="modal-close challenge-modal-close">&times;</button>
                <h3 class="modal-title">🎯 设置挑战目标</h3>
                <div class="challenge-modal-form">
                    <div class="form-group">
                        <label for="challengeTargetInput">目标金币数量</label>
                        <input type="number" id="challengeTargetInput" min="100" step="100" placeholder="例如：10000">
                    </div>
                    <div class="challenge-form-actions">
                        <button id="cancelChallengeBtn" class="btn-secondary">取消</button>
                        <button id="confirmChallengeBtn" class="btn-primary">确定</button>
                    </div>
                </div>
            </div>
        </div>
                </div>
                
    <!-- 登录模态框（仅登录） -->
    <div id="authModal" class="modal" style="display: none;">
        <div class="modal-backdrop auth-modal-backdrop">
            <div class="modal-content auth-modal-content">
                <button class="modal-close auth-modal-close" onclick="document.getElementById('authModal').style.display='none'">&times;</button>
                <div class="auth-section active">
                    <div class="auth-modal-header">
                        <div class="auth-modal-icon">🔓</div>
                        <h3>欢迎回来</h3>
                        <p>使用您的账户ID登录</p>
                    </div>
                      <form id="loginForm" class="auth-form">
                          <div class="form-group">
                            <label for="loginUsername">账户ID</label>
                              <input type="text" id="loginUsername" placeholder="输入24位账户ID" required>
                            <small class="form-hint">💡 登录需要使用注册时获得的账户ID</small>
                          </div>
                        <button type="submit" class="btn-primary auth-submit-btn">
                            <span>登录账户</span>
                        </button>
                      </form>
                    <div class="auth-footer-hint">
                        <p>还没有账户？<button class="auth-link-btn" onclick="document.getElementById('authModal').style.display='none';document.getElementById('registerModal').style.display='flex'">立即注册</button></p>
                    </div>
                </div>
            </div>
                          </div>
                </div>
                
    <!-- 注册模态框（仅注册） -->
    <div id="registerModal" class="modal" style="display: none;">
        <div class="modal-backdrop auth-modal-backdrop">
            <div class="modal-content auth-modal-content">
                <button class="modal-close auth-modal-close" onclick="document.getElementById('registerModal').style.display='none'">&times;</button>
                <div class="auth-section active">
                    <div class="auth-modal-header">
                        <div class="auth-modal-icon">✨</div>
                        <h3>创建账户</h3>
                        <p>注册以同步您的数据到云端</p>
                    </div>
                    <form id="registerForm" class="auth-form">
                        <div class="form-group">
                            <label for="registerUsername">用户名</label>
                            <input type="text" id="registerUsername" placeholder="输入您想要的用户名" required>
                            <small class="form-hint">💡 用户名仅用于显示，登录需使用系统生成的账户ID</small>
                      </div>
                        <button type="submit" class="btn-primary auth-submit-btn">
                            <span>创建账户</span>
                        </button>
                    </form>
                    <div class="auth-footer-hint">
                        <p>已有账户？<button class="auth-link-btn" onclick="document.getElementById('registerModal').style.display='none';document.getElementById('authModal').style.display='flex'">立即登录</button></p>
                      </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 账户ID显示模态框 -->
    <div id="binIdModal" class="modal bin-id-modal" style="display: none;">
        <div class="modal-backdrop bin-id-modal-backdrop">
            <div class="modal-content bin-id-modal-content">
                <div class="bin-id-modal-icon">🔑</div>
                <h3>注册成功！</h3>
                <p>您的专属账户ID已生成，请妥善保存：</p>
                <div class="bin-id-container">
                    <div class="bin-id-display">
                        <input type="text" id="binIdDisplay" readonly>
                        <button id="copyBinIdBtn" class="copy-btn" title="复制账户ID">📋</button>
                    </div>
                    <div class="bin-id-info">
                        <p>💡 <strong>重要提示：</strong></p>
                        <ul>
                            <li>账户ID是您账户的唯一标识</li>
                            <li>登录时必须使用账户ID</li>
                            <li>请妥善保存，丢失后无法找回</li>
                        </ul>
                    </div>
                </div>
                <div class="bin-id-modal-footer">
                    <button id="binIdModalClose" class="btn-primary">我知道了</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 加入排行榜确认模态框 -->
    <div id="joinLeaderboardModal" class="modal join-leaderboard-modal" style="display: none;">
        <div class="modal-backdrop join-leaderboard-modal-backdrop">
            <div class="modal-content join-leaderboard-modal-content">
                <button class="modal-close join-leaderboard-modal-close">&times;</button>
                <div class="join-leaderboard-modal-header">
                    <div class="join-leaderboard-modal-icon">🏆</div>
                    <h3>加入公开排行榜</h3>
                    <p>您的数据将公开显示在排行榜中</p>
                </div>
                <div class="join-leaderboard-modal-body">
                    <div class="privacy-notice">
                        <h4>📋 隐私说明</h4>
                        <ul>
                            <li>✅ 您的用户名和金币总数将公开显示</li>
                            <li>✅ 其他用户可以看到您的排名和基本统计</li>
                            <li>❌ 您的具体金币记录不会公开</li>
                            <li>❌ 您的密码和个人信息不会泄露</li>
                        </ul>
                    </div>
                    <div class="current-user-info">
                        <h4>👤 您的信息</h4>
                        <div class="user-info-item">
                            <span class="label">用户名：</span>
                            <span id="joinModalUsername" class="value">-</span>
                        </div>
                        <div class="user-info-item">
                            <span class="label">当前金币：</span>
                            <span id="joinModalCoins" class="value">-</span>
                        </div>
                        <div class="user-info-item">
                            <span class="label">账户ID：</span>
                            <span id="joinModalBinId" class="value">-</span>
                        </div>
                    </div>
                </div>
                <div class="join-leaderboard-modal-footer">
                    <button id="cancelJoinBtn" class="btn-secondary">取消</button>
                    <button id="confirmJoinBtn" class="btn-primary">确认加入</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 数据迁移提示模态框 -->
    <div id="migrationModal" class="modal migration-modal" style="display: none;">
        <div class="modal-backdrop migration-modal-backdrop">
            <div class="modal-content migration-modal-content">
                <div class="migration-modal-icon">☁️</div>
                <h3>数据迁移</h3>
                <p>检测到您有本地数据，是否要迁移到云端？</p>
                <div class="migration-info">
                    <div class="migration-item">
                        <span class="migration-label">金币记录：</span>
                        <span id="migrationRecordsCount" class="migration-value">0</span>
                    </div>
                    <div class="migration-item">
                        <span class="migration-label">连击数据：</span>
                        <span id="migrationStreakStatus" class="migration-value">无</span>
                    </div>
                    <div class="migration-item">
                        <span class="migration-label">成就数据：</span>
                        <span id="migrationAchievementsStatus" class="migration-value">无</span>
                    </div>
                </div>
                <div class="migration-actions">
                    <button id="migrationSkipBtn" class="btn-secondary">跳过</button>
                    <button id="migrationConfirmBtn" class="btn-primary">迁移到云端</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 用户详情模态框 -->
    <div id="userDetailModal" class="modal user-detail-modal" style="display: none;">
        <div class="modal-backdrop user-detail-modal-backdrop">
            <div class="modal-content user-detail-modal-content">
                <button class="modal-close user-detail-modal-close">&times;</button>
                <div class="user-detail-modal-header">
                    <div class="user-detail-modal-icon">👤</div>
                    <h3 id="userDetailUsername">用户名</h3>
                    <p id="userDetailRank">排名: -</p>
                </div>
                <div class="user-detail-modal-body">
                    <div class="user-detail-stats">
                        <div class="stat-card">
                            <div class="stat-icon">💰</div>
                            <div class="stat-info">
                                <div class="stat-value" id="userDetailTotalCoins">0</div>
                                <div class="stat-label">总金币</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">📊</div>
                            <div class="stat-info">
                                <div class="stat-value" id="userDetailRecordCount">0</div>
                                <div class="stat-label">记录数</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🔥</div>
                            <div class="stat-info">
                                <div class="stat-value" id="userDetailStreak">0</div>
                                <div class="stat-label">连续天数</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🏆</div>
                            <div class="stat-info">
                                <div class="stat-value" id="userDetailAchievements">0</div>
                                <div class="stat-label">成就数</div>
                            </div>
                        </div>
                    </div>
                    <div class="user-detail-titles" id="userDetailTitles">
                        <h4>称号</h4>
                        <div class="titles-list" id="userDetailTitlesList"></div>
                    </div>
                    <div class="user-detail-time">
                        <div class="time-info">
                            <span class="time-label">最后活跃:</span>
                            <span class="time-value" id="userDetailLastActive">-</span>
                        </div>
                    </div>
                    <div class="user-detail-records" id="userDetailRecords">
                        <h4>最近记录</h4>
                        <div class="records-list" id="userDetailRecordsList"></div>
                    </div>
                </div>
                <div class="user-detail-modal-footer">
                    <button id="closeUserDetailBtn" class="btn-primary">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="script.js"></script>

    <!-- Service Worker注册 -->
    <script>
        // 注册Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWA安装提示
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Tab切换逻辑
        document.addEventListener('DOMContentLoaded', () => {
            const navItems = document.querySelectorAll('.nav-item');
            const tabContents = document.querySelectorAll('.tab-content');

            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    const targetTab = item.dataset.tab;
                    
                    // 移除所有active类
                    navItems.forEach(nav => nav.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // 添加active类到当前tab
                    item.classList.add('active');
                    const targetContent = document.querySelector(`[data-tab-content="${targetTab}"]`);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                });
            });
        });
    </script>
</body>
</html>
